---
layout: post
title: "GPUImage"
description: ""
category: ioså¼€å‘
tags: [ui]
author: é¥­å°å›¢
---


#GPUImage
#####Written by Mattt Thompson â€” May 6th, 2013

è¿™é‡Œæ˜¯NSHipster,æˆ‘ä»¬æ¯å¤©æ€»æ˜¯åœ¨æŒ–æ˜Objective-cé‡Œé¢çš„é»‘æš—è§’è½å»å­¦ä¹ è¿™ä¸ªç³»ç»Ÿï¼Œç»å¸¸åœ°ä»”ç»†æŸ¥çœ‹appleæ¡†æ¶å’Œè¯­è¨€åŠŸèƒ½ã€‚ç„¶è€Œï¼Œå¶å°”çš„ä¹Ÿè¯¥å…³å¿ƒä¸€ä¸‹è¿™äº›ç”Ÿæœºå‹ƒå‹ƒçš„ç¬¬ä¸‰æ–¹æ¡†æ¶çš„é£æ™¯ã€‚çœ‹ä¸€çœ‹åœ¨æ—§é‡‘å±±ä¹‹å¤–è¿˜æœ‰ä»€ä¹ˆæ–°é²œå’Œä¼Ÿå¤§çš„äº‹æƒ…æ­£åœ¨å‘ç”Ÿã€‚

è¿™å‘¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€çœ‹è¿™ä¸ªä»¤äººå°è±¡æ·±åˆ»çš„ç¬¬ä¸‰æ–¹å¼€æºæ¡†æ¶ï¼šGPUimageã€‚åœ¨æœ¬æ–‡ç»“æŸåä½ ä¹Ÿè®¸ä¹Ÿå¯ä»¥è‡ªå·±åšä¸€ä¸ªappç…§ç›¸æœºã€‚

---

GPUImage æ˜¯ä¸€ä¸ªBSDè®¤è¯çš„æ¡†æ¶ï¼Œç”± Brad Larsonæ’°å†™ã€‚å®ƒå¯ä»¥è®©ä½ åº”ç”¨çš„GPUåŠ é€Ÿè¿‡æ»¤å™¨å¹¶ä¸”ç”¨æ¥åˆ¶ä½œç‰¹æ•ˆå›¾ç‰‡ï¼Œæ‘„åƒå’Œç”µå½±ã€‚


###GPU vs. CPU

æ¯ä¸€ä¸ªiphoneéƒ½è£…è½½äº†ä¸¤ä¸ªå¤„ç†å™¨ï¼šCPUå’ŒGPUã€‚æ¯ä¸ªå¤„ç†å™¨éƒ½æœ‰è‡ªå·±çš„ä¼˜åŠ¿ã€‚ç°ä»£çš„èŠ¯ç‰‡æ¶æ„éƒ½åŒæ—¶åœ¨ä¸€ä¸ªç‰©ç†æ¨¡å—ä¸Šé›†æˆäº†CPUå’ŒGPUã€‚

å½“ä½ åœ¨ç”¨cæˆ–objctive-cæ—¶ï¼Œä½ ç”Ÿæˆçš„æ‰€æœ‰æŒ‡ä»¤å¤§å¤šéƒ½ç”±CPUæ‰§è¡Œã€‚è€ŒGPUéå¸¸é€‚åˆè®¡ç®—é‚£äº›å°çš„ï¼Œç‹¬ç«‹æ€§çš„æ“ä½œï¼Œæ¯”å¦‚å›¾å½¢ç»˜åˆ¶ã€‚æˆ‘ä»¬æ˜¯ç”¨ä¸€ä¸ªä¸åŒçš„è¯­è¨€OpenGLæ¥å†™ä»–ã€‚

æ¯”è¾ƒä¸€ä¸‹å¯¹äºvideoçš„åŸºGPUçš„æ¸²æŸ“ä¸CPUæ¸²æŸ“çš„åŒºåˆ«ï¼Œä»–ä»¬çš„ä¸åŒä»¤äººæ„•ç„¶ã€‚

CPU vs. GPU Frame-Rate (Larger FPS is Better)

 ------ Calculation ---------- GPU FPS --- CPU FPS --- Î”

 ------ Thresholding â¨‰ 1 ------ 60.00 -------- 4.21 --- 14.3â¨‰

 ------ Thresholding â¨‰ 2 ------ 33.63 -------- 2.36 --- 14.3â¨‰

 ------ Thresholding â¨‰ 100 ---- 1.45 --------- 0.05 --- 28.7â¨‰

####æ¸²æŸ“ç®¡é“
![Alt text](../attachment/fanshen/RenderingPipeline.png)
GPUImageæ˜¯ä¸€ä¸ªä»Objective-CæŠ½è±¡å‡ºæ¥çš„æ¸²æŸ“ç®¡é“ï¼Œæºå›¾ç‰‡ä»ç›¸æœºï¼Œç½‘ç»œï¼Œç¡¬ç›˜åŠ è½½ã€‚é€šè¿‡è¿‡æ»¤å±‚æ“ä½œã€‚æœ€åä»åˆ«çš„åœ°æ–¹ï¼ˆview, graphics context, or data streamï¼‰è¾“å‡º

ä¸¾ä¸ªæ —å­ğŸŒ°ï¼šå›¾ç‰‡ä»ç›¸æœºè·å–ï¼Œç”¨ä¸€ä¸ªColor Levels filteræ¨¡æ‹Ÿä¸€ä¸ªä¸åŒç±»å‹çš„è‰²ç›²æ•ˆæœå¹¶æ˜¾ç¤º

	GPUImageVideoCamera *videoCamera = [[GPUImageVideoCamera alloc]
    			initWithSessionPreset:AVCaptureSessionPreset640x480
               		   cameraPosition:AVCaptureDevicePositionBack];
	videoCamera.outputImageOrientation = UIInterfaceOrientationPortrait;

	GPUImageFilter *filter = [[GPUImageLevelsFilter alloc]
							 initWithFragmentShaderFromFile:@"CustomShader"];
		[filter setRedMin:0.299 gamma:1.0 max:1.0 minOut:0.0 maxOut:1.0];
		[filter setGreenMin:0.587 gamma:1.0 max:1.0 minOut:0.0 maxOut:1.0];
		[filter setBlueMin:0.114 gamma:1.0 max:1.0 minOut:0.0 maxOut:1.0];
		[videoCamera addTarget:filter];

	GPUImageView *filteredVideoView = [[GPUImageView alloc] initWithFrame:self.view.bounds];
	[filter addTarget:filteredVideoView];
	
	[self.view addSubview:filteredVideoView];

	[videoCamera startCameraCapture];

æˆ–è€…ç»“åˆå¤šç§ä¸åŒé…è‰²æ¨¡å‹ï¼Œå›¾ç‰‡æ•ˆæœ,è°ƒæ•´å¯¹æ¯”åº¦ã€‚åˆ†äº«ç»™ä½ çš„æœ‹å‹

	GPUImageFilterGroup *filter = [[GPUImageFilterGroup alloc] init];
	GPUImageSaturationFilter *saturationFilter = [[GPUImageSaturationFilter alloc] init];
	[saturationFilter setSaturation:0.5];

	GPUImageMonochromeFilter *monochromeFilter = [[GPUImageMonochromeFilter alloc] init];
	[monochromeFilter setColor:(GPUVector4){0.0f, 0.0f, 1.0f, 1.0f}];
	[monochromeFilter setIntensity:0.2];

	GPUImageVignetteFilter *vignetteFilter = [[GPUImageVignetteFilter alloc] init];
	[vignetteFilter setVignetteEnd:0.7];

	GPUImageExposureFilter *exposureFilter = [[GPUImageExposureFilter alloc] init];
	[exposureFilter setExposure:0.3];

	[filter addGPUFilter:exposureFilter];
	[filter addGPUFilter:monochromeFilter];
	[filter addGPUFilter:saturationFilter];
	[filter addGPUFilter:vignetteFilter];

å¥½ï¼Œå°±è¿™æ ·ï¼ ç»“æŸè¯­ä¸ç¿»è¯‘å•¦~ ç¥å„ä½ç©çš„æ„‰å¿«ï¼





